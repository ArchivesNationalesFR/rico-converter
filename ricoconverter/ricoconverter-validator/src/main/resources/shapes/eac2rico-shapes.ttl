@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix dct: <http://purl.org/dc/terms/> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix dash: <http://datashapes.org/dash#> .
@prefix foaf: <http://xmlns.com/foaf/0.1/> .
@prefix dc: <http://purl.org/dc/elements/1.1/> .
@prefix skos: <http://www.w3.org/2004/02/skos/core#> .
@prefix skosxl: <http://www.w3.org/2008/05/skos-xl#> .
@prefix rico: <https://www.ica.org/standards/RiC/ontology#> .
@prefix ans: <http://data.archives-nationales.culture.gouv.fr/eac2rico/shapes/> .

rico:Thing a sh:NodeShape, rdfs:Class ;
	sh:property [
		sh:description "The value of rico:hasLocation MUST be a known rico:Place in the Place vocabulary." ;
		sh:path rico:hasLocation ;
		sh:nodeKind sh:IRI ;
		sh:class rico:Place ;
	] ;
	.

rico:Place a sh:NodeShape, rdfs:Class ;
	sh:property [
		sh:description "A rico:Place SHOULD not have more that 1 value of rico:hasLocation." ;
		sh:path rico:hasLocation ;
		sh:nodeKind sh:IRI ;
		sh:maxCount 1 ;
		# This shape triggers a Warning, not a formal violation with respect to RiC-O
		sh:severity sh:Warning ;
	] ;
	sh:sparql [
		sh:message "a rico:Place have 2 values for rico:hasLocation, one of which is more specific than the other." ;
		sh:prefixes rico: ;
		sh:select """
			PREFIX rico: <https://www.ica.org/standards/RiC/ontology#>
			SELECT $this (rico:hasLocation AS ?path) ?value
			WHERE {
				$this rico:hasLocation ?value .
				$this rico:hasLocation ?moreSpecificValue .
				?moreSpecificValue rico:isPartOf|(rico:isPartOf/rico:isPartOf)|(rico:isPartOf/rico:isPartOf/rico:isPartOf) ?value .
				FILTER(?moreSpecificValue != ?value)
			}
			""" ;
		# This shape triggers an Info message, not a formal violation with respect to RiC-O
		sh:severity sh:Info ;
	]
	.